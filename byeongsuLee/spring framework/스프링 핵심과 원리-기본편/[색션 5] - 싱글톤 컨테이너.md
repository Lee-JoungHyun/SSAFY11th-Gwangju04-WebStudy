# 스프링 핵심과 원리 기본편 [색션 5] - 싱글톤 컨테이너

## 웹 애플리케이션과 싱글톤

- 여러 명이 접속할때 appconfig 객체가 여러 번 생성된다는 문제가 발생
- 해결방법은 한번 생성하고 공유해서 쓰면된다.
- 그게 바로 싱글톤 객체다.

## 싱글톤 패턴

- 객체를 한번 생성하고 그것을 계속 쓰는 방식
- 문제점
    - 코드가 양이 많다.
    - 클라이언트가 구체클래스에 의존한다. getintance
    - 테트하기 어렵다.

# 싱글톤 컨테이너 = spring container

- 싱글톤의 문제점을 다 제거한 컨테이너를 말한다.
- DIP,OCP, 테스트, private 생성자로부터 자유롭게 싱글톤을 사용할 수 있따.
- 여러 클라이언트가 하나의 같은 인스턴스를 공유하기 때문에 싱글 톤 객체는 상태를 유지하게 설계하면 안된다.
- 무상태로 설계해야한다 .
    - 특정 클라이언트에 값을 변경할 수 있는 필드가 있으면 안된다.
    - 필드 대신에 공유되지않는 지역변수 파라미터 threadLocal을 사용하자.
- 예시
    - a,b 사람이 상품구매를 했을떄 a는 10000원 , b는 20000원을 썻다가 가정해보자.
    - a의 가격표를 봤을떄 10000원이 아닌 마지막에 결제된 b의 금액인 20000원이 나오게된다.
    

## 스프링빈은 항상 무상태로 설계하자!!

# @Configuration

appConfig을 보면 new MemberRepository가 2번 생성되서 싱글톤을 위배하는 거 아닌가?

막상 실행해보면 한번만 호출되고 생성은 딱 한번만 된다.

# @Configuration 싱글톤 보장 원리

스프링 컨테이너는 싱글톤 레지스트리다. 스프링 빈이 싱글톤이 되도록 보장해줘야 한다.

우리가 설정해준 appconfig가 아닌 appconfig을 상속한 appCoing@cglib 가 등록이된다!

이미 만들어진 빈이면 존재하는 빈을 반환하고 , 없으면 스프링 빈으로 등록하고 반환하는 코드가 만들어져 싱글톤이 보장된다.

# @Configuration 빼보기

- 싱글톤 보장 x
- 컨테이너가 객체 관리 x
