  
웹 애플리케이션 개발 시, 사용자 입력의 유효성 검증은 필수. 잘못된 데이터 입력이나 의도치 않은 값 입력에 대비해야 함.

---
- **Model 객체 검증 방식**
    - 오류 이름을 키로, 오류 메시지를 값으로 하는 Map 자료구조 활용.
    - 오류 정보를 Model에 추가 후, 입력 폼으로 반환.
    - 프론트엔드에서는 반환된 오류 객체를 확인하고, 존재하는 오류 메시지를 사용자에게 표시.
    - 예시: `<div th:if="${errors?.containsKey('globalError')}">`를 통해 전역 오류 존재 시 메시지 출력.
    - 문제점: 중복 처리 문제, 타입 오류에 대한 미흡한 처리, 컨트롤러 진입 전 예외 발생 시 400 에러로 이어지며 사용자 입력 정보 손실.

이 방법은 특히, 오류 처리의 중복성, 타입 오류 대응의 한계, 그리고 예외 발생 시 사용자 입력 정보의 손실 등의 단점을 가짐. 이러한 이유로, 복잡성이 증가하고, 사용자 경험에 부정적인 영향을 미칠 수 있어, 보다 체계적이고 효율적인 유효성 검증 방법의 고려가 필요함.

---
스프링에서는 `BindingResult`를 이용해 입력 값 검증을 보다 세련되게 처리할 수 있음. 이 방법은 컨트롤러에서 입력 값에 문제가 있을 때 쉽게 오류 메시지를 추가하고, 사용자에게 피드백을 줄 수 있도록 도와줌.

- **BindingResult 검증 방식**
  - 컨트롤러 메소드의 파라미터로 `BindingResult` 객체를 추가. 이 객체는 검증하고자 하는 객체 바로 뒤에 위치해야 함.
  - 검증 실패 시, `BindingResult`의 `addError` 메소드를 사용해 오류 정보를 추가. 여기에는 `FieldError` 또는 `ObjectError` 객체가 사용됨.
    - **FieldError**: 특정 필드에 대한 오류 정보를 나타냄. 필드 이름과 오류 메시지를 포함.
    - **ObjectError**: 객체 수준의 글로벌 오류를 나타냄. 주로 객체 전체와 관련된 유효성 검사 실패를 처리할 때 사용.
  - 타임리프에서는 `#fields`를 사용하여 검증 오류에 접근 가능. 예를 들어, `th:if="${#fields.hasGlobalErrors()}"`는 글로벌 오류가 있는 경우 해당 태그를 활성화함.

### 글로벌 오류 처리 예시
```java
bindingResult.addError(new ObjectError("item", "가격 * 수량의 합은 10,000원 이상이어야 합니다. 현재 값 = " + resultPrice));
```
이는 객체 이름과 기본 오류 메시지를 생성자 파라미터로 받아, 전체 객체에 대한 유효성 검사 실패를 표시함.

### FieldError와 ObjectError 생성자
`FieldError`와 `ObjectError`는 각각 두 가지 생성자를 제공함. 이를 통해 오류 메시지, 거부된 값, 바인딩 실패 여부 등 다양한 정보를 상세하게 설정할 수 있음.

- **FieldError 생성자**
  - 간단한 형태: 필드 이름, 오류 메시지만을 설정.
  - 상세한 형태: 거부된 값, 바인딩 실패 여부, 오류 코드, 오류 메시지 등을 포함하여 오류 정보를 더 상세히 설정 가능.

- **ObjectError 생성자**
  - 글로벌 오류 처리를 위해 사용되며, 유사하게 간단한 형태와 상세한 형태의 생성자를 제공함.

그러나 `BindingResult`를 사용하더라도 타입 오류 처리와 사용자 입력 정보의 유지에 한계가 있을 수 있음. 따라서 더 나은 사용자 경험과 오류 처리를 위해 추가적인 접근 방법을 고려하는 것이 중요함.

---
오류 메시지를 중앙에서 관리하고 메시지 국제화를 적용하는 것은 애플리케이션 개발에서 매우 중요한 부분임. 이 접근 방식은 오류 메시지의 유지보수를 단순화하고, 애플리케이션의 다국어 지원 능력을 향상시킴. 여기에 `BindingResult`를 활용하면, 폼 검증 로직을 더욱 효과적으로 구현할 수 있음.

### 오류 메시지 중앙 관리의 이점
- **유지보수성 향상**: 오류 메시지를 한 곳에서 관리함으로써, 변경 사항이 있을 경우 한 파일만 업데이트하면 되므로 유지보수가 용이함.
- **국제화 지원**: 메시지 소스를 활용하여 다양한 언어의 오류 메시지를 손쉽게 지원할 수 있음. 이는 글로벌 시장을 대상으로 하는 애플리케이션에 필수적임.
- **코드 중복 제거**: `ErrorMessage.properties`와 같은 프로퍼티 파일을 사용하여 중복되는 오류 메시지 코드를 제거함. 이로써 코드의 가독성과 관리성이 향상됨.

### 구현 예시 및 방법
1. **`application.properties` 설정 추가**:
   ```
   spring.messages.basename=messages,errors
   ```
   이 설정은 스프링 부트 애플리케이션에 메시지 소스 파일의 위치를 지정함.

2. **`ErrorMessage.properties` 파일 생성**:
   ```java
   # 기본 오류 메시지
   error.default=오류가 발생했습니다. 다시 시도해 주세요.
   # 필드 관련 오류 메시지
   error.field.required={0} 필드는 필수입니다.
   error.field.email=유효한 이메일 주소를 입력해 주세요.
   ```
   이 파일에는 오류 코드와 해당하는 메시지 템플릿을 정의함.

3. **`BindingResult` 활용**:
   컨트롤러 메소드에서 `BindingResult` 객체를 파라미터로 추가하여, 폼 검증 후 발생한 오류를 관리함. `rejectValue()`와 `reject()` 메서드를 사용하여 검증 과정에서 발생한 오류를 간소화하여 추가함.
   ```java
   public String submitForm(@ModelAttribute("form") Form form, BindingResult result) {
       if (form.getPrice() < 0) {
           result.rejectValue("price", "error.field.price", "가격은 0 이상이어야 합니다.");
       }
       if (result.hasErrors()) {
           return "form";
       }
       return "success";
   }
   ```

### `ErrorMessage.properties` 정의 시 주의사항
- 오류 메시지는 범용적인 것부터 구체적인 것 순으로 정리해야 함. 이는 프로퍼티 파일에서 상위에 위치한 메시지가 더 높은 우선순위를 가지기 때문임.
- 위의 접근 방식을 통해 오류 메시지를 추가하거나 코드를 수정할 때 편리함을 경험할 수 있음. 오류 메시지의 우선순위를 고려하여, 가장 적절한 메시지가 사용자에게 표시되도록 함.

이런 방식으로 오류 메시지와 폼 검증 로직을 구현하면, 개발자는 더 깨끗하고 관리하기 쉬운 코드를 유지할 수 있으며, 사용자에게는 보다 명확하고 이해하기 쉬운 피드백을 제공할 수 있음.

---
`MessageCodeResolver`는 스프링 프레임워크에서 오류 메시지 코드를 해석하는 역할을 담당하는 컴포넌트임. 이는 오류 발생 시, 해당 오류에 맞는 메시지 코드를 생성하고, 이 코드를 바탕으로 적절한 오류 메시지를 찾아내는 메커니즘을 제공함. `MessageCodeResolver`는 `BindingResult`와 밀접하게 연관되어 있으며, 폼 검증 과정에서 발생한 오류들에 대해 사용자에게 보여줄 메시지 코드를 생성하는 데 사용됨.

### MessageCodeResolver의 역할
- **오류 메시지 코드 생성**: 검증 과정에서 발생한 오류 유형에 따라 구체적인 오류 메시지 코드를 생성함. 이 코드는 메시지 소스 파일(`.properties`)에서 해당 오류 메시지를 찾는 데 사용됨.
- **국제화 지원**: 다양한 언어로 된 오류 메시지를 지원하기 위해, 생성된 메시지 코드를 바탕으로 메시지 소스에서 적절한 언어의 오류 메시지를 조회함.
- **오류 메시지 우선순위 결정**: 하나의 오류에 대해 여러 메시지 코드가 생성될 수 있음. `MessageCodeResolver`는 이러한 코드들 사이의 우선순위를 결정하여, 가장 적절한 오류 메시지를 선택하는 역할을 함.

### 작동 원리
1. **오류 발생 시**, `BindingResult`에 오류 정보가 추가됨.
2. **`MessageCodeResolver` 사용**: 오류 정보를 바탕으로 하나 이상의 메시지 코드를 생성함. 예를 들어, 필드 'email'에 대한 오류는 `error.field.email`, `error.field`와 같이 여러 메시지 코드를 생성할 수 있음.
3. **메시지 소스 조회**: 생성된 메시지 코드를 사용하여, 애플리케이션의 메시지 소스 파일에서 적절한 오류 메시지를 찾음. 이 과정에서 애플리케이션의 현재 언어 설정에 따른 국제화 메시지를 선택할 수 있음.

### 활용 예시
오류 메시지 코드의 생성과 해석 과정을 통해, 개발자는 검증 로직과 오류 메시지 관리를 보다 유연하고 효율적으로 수행할 수 있음. 예를 들어, `ErrorMessage.properties` 파일에서 오류 메시지를 다음과 같이 정의할 수 있음:

```properties
# 기본 오류 메시지
error.default=오류가 발생했습니다. 다시 시도해 주세요.

# 필드별 오류 메시지
error.field.required={0} 필드는 필수입니다.
error.field.email=유효한 이메일 주소를 입력해 주세요.
```

이러한 방식으로 `MessageCodeResolver`를 활용하면, 오류 유형에 따라 자동으로 적절한 메시지 코드를 생성하고, 이 코드를 바탕으로 사용자에게 명확하고 이해하기 쉬운 피드백을 제공할 수 있음. 따라서, 애플리케이션의 사용자 경험을 개선하고, 다국어 지원을 강화하는 데 중요한 역할을 함.

---
`WebDataBinder`는 스프링 MVC에서 웹 요청 파라미터를 Java 객체에 바인딩하는 과정을 관리하고, 이 과정에서 발생할 수 있는 변환(conversion) 및 검증(validation) 작업을 처리하는 컴포넌트입니다. `WebDataBinder`를 사용하면, 클라이언트에서 전송된 데이터를 컨트롤러의 핸들러 메소드가 받는 커맨드 객체나 폼 객체에 매핑할 때, 필드 값의 변환 처리 및 유효성 검사 로직을 손쉽게 적용할 수 있습니다.

### WebDataBinder의 핵심 기능
- **데이터 바인딩**: HTTP 요청 파라미터를 객체의 필드에 자동으로 바인딩합니다. 예를 들어, 폼 데이터나 쿼리 파라미터를 커맨드 객체의 필드와 매핑합니다.
- **타입 변환**: 클라이언트로부터 전달받은 문자열 데이터를 해당 필드의 타입(예: `Integer`, `Date` 등)으로 변환합니다. 이를 위해 스프링은 `PropertyEditor` 또는 `Converter`와 `Formatter` API를 제공합니다.
- **검증**: `Validator` 인터페이스를 구현한 검증 로직을 통해 바인딩된 객체의 유효성 검사를 수행합니다. 검증 과정에서 발생한 오류는 `BindingResult`에 저장됩니다.

### 결합 사용: WebDataBinder와 MessageCodeResolver
`WebDataBinder`의 검증 과정에서 `MessageCodeResolver`가 오류 메시지 코드를 생성하고, 이를 기반으로 사용자에게 보여줄 오류 메시지를 결정합니다. 이런 식으로, `WebDataBinder`는 데이터의 바인딩 및 변환 처리를 담당하고, `MessageCodeResolver`는 발생한 오류에 대한 적절한 메시지 코드를 생성하여, 검증 로직과 메시지 관리의 효율성을 높여주는 역할을 합니다.

이렇게 `WebDataBinder`와 `MessageCodeResolver`를 조합하여 사용하면, 스프링 MVC 애플리케이션에서 요청 데이터의 처리와 오류 메시지의 관리를 보다 효과적이고 체계적으로 할 수 있습니다.